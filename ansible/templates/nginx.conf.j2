server {    listen 80;    server_name {{ app_domain | default('localhost') }};        # Redirection HTTPS    {% if app_domain is defined %}    return 301 https://$server_name$request_uri;}server {    listen 443 ssl http2;    server_name {{ app_domain }};        ssl_certificate /etc/letsencrypt/live/{{ app_domain }}/fullchain.pem;    ssl_certificate_key /etc/letsencrypt/live/{{ app_domain }}/privkey.pem;        ssl_protocols TLSv1.2 TLSv1.3;    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;    ssl_prefer_server_ciphers off;    {% endif %}        # Configuration générale    client_max_body_size 50M;    proxy_connect_timeout 30s;    proxy_send_timeout 30s;    proxy_read_timeout 30s;        # Headers de sécurité    add_header X-Frame-Options "SAMEORIGIN" always;    add_header X-Content-Type-Options "nosniff" always;    add_header X-XSS-Protection "1; mode=block" always;    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;        # Gestion des erreurs    error_page 502 503 504 /50x.html;    location = /50x.html {        root /var/www/html;    }        # API Backend    location /api {        proxy_pass http://127.0.0.1:3001;        proxy_http_version 1.1;        proxy_set_header Upgrade $http_upgrade;        proxy_set_header Connection 'upgrade';        proxy_set_header Host $host;        proxy_set_header X-Real-IP $remote_addr;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        proxy_set_header X-Forwarded-Proto $scheme;        proxy_cache_bypass $http_upgrade;        proxy_buffering off;    }        # WebSocket support    location /socket.io {        proxy_pass http://127.0.0.1:3001;        proxy_http_version 1.1;        proxy_set_header Upgrade $http_upgrade;        proxy_set_header Connection "upgrade";        proxy_set_header Host $host;        proxy_set_header X-Real-IP $remote_addr;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        proxy_set_header X-Forwarded-Proto $scheme;    }        # Frontend Next.js    location / {        proxy_pass http://127.0.0.1:3000;        proxy_http_version 1.1;        proxy_set_header Upgrade $http_upgrade;        proxy_set_header Connection 'upgrade';        proxy_set_header Host $host;        proxy_set_header X-Real-IP $remote_addr;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        proxy_set_header X-Forwarded-Proto $scheme;        proxy_cache_bypass $http_upgrade;        proxy_buffering off;    }        # Assets statiques    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {        proxy_pass http://127.0.0.1:3000;        expires 1y;        add_header Cache-Control "public, immutable";    }        # Next.js API routes    location /_next/static {        proxy_pass http://127.0.0.1:3000;        expires 1y;        add_header Cache-Control "public, immutable";    }        # Logs    access_log /var/log/nginx/{{ app_name }}_access.log;    error_log /var/log/nginx/{{ app_name }}_error.log;}